@commands.command(name='sacrifice', aliases=['sac'])
async def sacrifice_beast(ctx, beast_id: int):
    """Sacrifice a beast to gain experience for your active beast"""
    user = await ctx.bot.get_or_create_user(ctx.author.id, str(ctx.author))
    user_beasts = await ctx.bot.db.get_user_beasts(ctx.author.id)

    # Locate the target beast
    target_beast = None
    for bid, beast in user_beasts:
        if bid == beast_id:
            target_beast = beast
            break

    # Error: No such beast
    if not target_beast:
        embed = discord.Embed(color=0xFF1744)
        embed.add_field(
            name="â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",
            value="# ğŸš« âš¡ IMMORTAL BEAST SHRINE âš¡ ğŸš«\n"
                  "## âŒ BEAST NOT FOUND âŒ\n"
                  "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",
            inline=False)
        embed.add_field(
            name="ğŸ” Beast Registry Search",
            value=(f"```
                   f"- Beast ID: #{beast_id}\n"
                   f"- Owner: {ctx.author.display_name}\n"
                   f"- Status: NOT FOUND\n"
                   f"- Collection: {len(user_beasts)} beasts\n"
                   f"```"),
            inline=False)
        embed.add_field(
            name="ğŸ’¡ Available Actions",
            value=(f"ğŸ“‹ `{ctx.bot.config.prefix}beasts` - View your collection\n"
                   f"ğŸ” `{ctx.bot.config.prefix}beast <id>` - Check beast details\n"
                   f"âš¡ Use a valid beast ID from your collection"),
            inline=False)
        embed.set_footer(text="âš¡ IMMORTAL BEAST SHRINE â€¢ Double-check your beast ID!")
        embed.timestamp = discord.utils.utcnow()
        await ctx.bot.safe_send_message(ctx.channel, embed=embed)
        return

    # Error: Attempting to sacrifice the active beast
    if beast_id == user.active_beast_id:
        embed = discord.Embed(color=0xFF6D00)
        embed.add_field(
            name="â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",
            value="# ğŸ›¡ï¸ âš¡ IMMORTAL BEAST SHRINE âš¡ ğŸ›¡ï¸\n"
                  "## âš ï¸ ACTIVE BEAST PROTECTED âš ï¸\n"
                  "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",
            inline=False)
        embed.add_field(
            name="ğŸŸ¢ Active Beast Status",
            value=(f"```
                   f"Protected Beast: {target_beast.name}\n"
                   f"Beast ID: #{beast_id}\n"
                   f"Status: CURRENTLY ACTIVE\n"
                   f"Protection: SHRINE GUARDIAN\n"
                   f"```"),
            inline=False)
        embed.add_field(
            name="ğŸ”„ Solution Required",
            value=(f"**Step 1:** Choose a different active beast\n"
                   f"**Step 2:** Use `{ctx.bot.config.prefix}active <other_beast_id>`\n"
                   f"**Step 3:** Return here to perform sacrifice\n\n"
                   "ğŸ›¡ï¸ The shrine protects your active companion!"),
            inline=False)
        embed.set_footer(text="âš¡ IMMORTAL BEAST SHRINE â€¢ Your active beast cannot be sacrificed!")
        embed.timestamp = discord.utils.utcnow()
        await ctx.bot.safe_send_message(ctx.channel, embed=embed)
        return

    # Calculate the rewards
    sacrifice_xp = target_beast.stats.get_total_exp_value(target_beast.rarity)
    beast_stones_reward = target_beast.stats.level * 10 + target_beast.rarity.value * 50

    # Find active beast (not the sacrificial one)
    active_beast = None
    if user.active_beast_id and user.active_beast_id != beast_id:
        for bid, beast in user_beasts:
            if bid == user.active_beast_id:
                active_beast = beast
                break

    # Confirmation embed
    embed = discord.Embed(color=0xFF3D00)
    power_bar = "ğŸ”´" * min(10, target_beast.power_level // 1000) or "â¬›"
    rarity_glow = "âœ¨" * target_beast.rarity.value
    embed.add_field(
        name="â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",
        value="# ğŸ”¥ âš¡ IMMORTAL BEAST SHRINE âš¡ ğŸ”¥\n"
              "## âš ï¸ SACRIFICE RITUAL INITIATED âš ï¸\n"
              "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",
        inline=False)
    embed.add_field(
        name="ğŸ‰ SACRIFICE CANDIDATE",
        value=(f"### {rarity_glow} {target_beast.name} {rarity_glow}\n"
               f"```
               f"Beast ID: #{beast_id}\n"
               f"Rarity: {target_beast.rarity.name.title()} {target_beast.rarity.emoji}\n"
               f"Level: {target_beast.stats.level}\n"
               f"Power: {target_beast.power_level:,}\n"
               f"```\n"
               f"**Power Level:** {power_bar}\n"
               f"**Origin:** {target_beast.location}"),
        inline=False)
    stone_value_bars = "ğŸ’" * min(8, beast_stones_reward // 100) or "â¬›"
    xp_value_bars = "âš¡" * min(8, sacrifice_xp // 500) or "â¬›"
    embed.add_field(
        name="ğŸ’° SHRINE REWARDS",
        value=(f"```
               f"Beast Stones: {beast_stones_reward:,}\n"
               f"Value Tier:  {stone_value_bars}\n"
               f"Formula:     (Level Ã— 10) + (Rarity Ã— 50)\n"
               f"```\n"
               f"ğŸ’ {beast_stones_reward:,} Beast Stones will be granted!"),
        inline=True)
    if active_beast:
        embed.add_field(
            name="ğŸ“ˆ SOUL TRANSFER",
            value=(f"```
                   f"Experience:  {sacrifice_xp:,} XP\n"
                   f"Power Tier:  {xp_value_bars}\n"
                   f"Recipient:   {active_beast.name}\n"
                   f"```\n"
                   f"âš¡ Soul energy flows to {active_beast.name}!"),
            inline=True)
    else:
        embed.add_field(
            name="ğŸ’€ LOST ESSENCE",
            value=(f"```
                   f"- Experience: {sacrifice_xp:,} XP\n"
                   f"- Status: NO ACTIVE BEAST\n"
                   f"- Result: ESSENCE DISPERSES\n"
                   f"```\n"
                   f"ğŸ’€ Soul energy will be lost forever!"),
            inline=True)

    embed.add_field(
        name="âš ï¸ RITUAL WARNING",
        value=("```
               "- Beast Stones: PERMANENT GAIN\n"
               f"{'+ Soul Transfer: TO ACTIVE BEAST' if active_beast else '- Soul Energy: LOST FOREVER'}\n"
               "- Beast Loss: IRREVERSIBLE\n"
               "- Shrine Decision: FINAL\n"
               "```"),
        inline=False)
    embed.add_field(
        name="ğŸ”¥ SHRINE RITUAL COMMANDS",
        value=("### âœ… COMPLETE SACRIFICE\n"
               "```
               "â–¶ Accept the shrine's power\n"
               "â–¶ Claim beast stones\n"
               f"{'â–¶ Transfer soul to active beast' if active_beast else 'â–¶ Release soul to the void'}\n"
               "```\n"
               "### âŒ ABANDON RITUAL\n"
               "```
               "â–¶ Preserve your beast\n"
               "â–¶ Leave shrine unchanged\n"
               "```"),
        inline=False)
    embed.add_field(
        name="â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",
        value="âš¡ IMMORTAL BEAST SHRINE â€¢ Ancient powers await your decision\n"
              "ğŸ”¥ *React within 30 seconds or the ritual will expire...*",
        inline=False)
    embed.set_author(
        name=f"Ritual Master: {ctx.author.display_name}",
        icon_url=ctx.author.display_avatar.url if hasattr(ctx.author, 'display_avatar') else None)
    embed.timestamp = discord.utils.utcnow()
    message = await ctx.bot.safe_send_message(ctx.channel, embed=embed)
    await ctx.bot.safe_add_reaction(message, "âœ…")
    await ctx.bot.safe_add_reaction(message, "âŒ")

    def check(reaction, react_user):
        return (react_user == ctx.author
                and str(reaction.emoji) in ["âœ…", "âŒ"]
                and reaction.message.id == message.id)

    try:
        reaction, _ = await ctx.bot.wait_for('reaction_add', timeout=30.0, check=check)

        if str(reaction.emoji) == "âœ…":
            success = await ctx.bot.db.delete_beast(beast_id)
            if not success:
                error_embed = discord.Embed(color=0xFF1744)
                error_embed.add_field(
                    name="â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",
                    value="# ğŸ’¥ âš¡ RITUAL FAILURE âš¡ ğŸ’¥\n"
                          "## âŒ SHRINE REJECTED SACRIFICE âŒ\n"
                          "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",
                    inline=False)
                error_embed.add_field(
                    name="ğŸ”§ System Error",
                    value="``````",
                    inline=False)
                await ctx.bot.safe_edit_message(message, embed=error_embed)
                return

            # Add rewards, transfer XP, do stat boosts if allowed, update user/beasts accordingly...

            # Success feedback embed creation code (not repeated here to save space, see sample output).

            await ctx.bot.safe_edit_message(message, embed=success_embed)
        else:
            # Ritual abandoned (similar embed logic as above)
            await ctx.bot.safe_edit_message(message, embed=abandoned_embed)
    except asyncio.TimeoutError:
        timeout_embed = discord.Embed(color=0x616161)
        timeout_embed.add_field(
            name="â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",
            value="# â³ âš¡ RITUAL EXPIRED âš¡ â³\n"
                  "## ğŸŒ™ SHRINE GROWS SILENT ğŸŒ™\n"
                  "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",
            inline=False)
        timeout_embed.add_field(
            name="â° Time's Judgment",
            value=(f"```
                   f"Ritual Duration: 30 seconds\n"
                   f"Response: NONE RECEIVED\n"
                   f"Shrine Status: DORMANT\n"
                   f"Beast Status: SAFE\n"
                   f"```\n"
                   f"ğŸŒ™ The shrine's power fades... {target_beast.name} remains protected"),
            inline=False)
        timeout_embed.add_field(
            name="ğŸ”® Ancient Wisdom",
            value="*The shrine only accepts offerings from those who act with certainty*\n"
                  "ğŸ’« Return when you're ready to make a decisive choice",
            inline=False)
        await ctx.bot.safe_edit_message(message, embed=timeout_embed)